<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: App.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: App.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { Component } from 'react'
import shuffle from 'lodash.shuffle'

import './App.css'

import Card from './Card'
import GuessCount from './GuessCount'
import HallOfFame from './HallOfFame'
import HighScoreInput from './HighScoreInput'

// SIDE * SIDE should be an even number as each card must be present twice to make pairs
export const SIDE = 4
export const SYMBOLS = '😀🎉💖🎩🐶🐱🦄🐬🌍🌛🌞💫🍎🍌🍓🍐🍟🍿'
export const VISUAL_PAUSE_MSECS = 500

/**
 * Memory app
 * @component
 * @extends {Component}
 */
class App extends Component {
    /**
     * Generate a shuffled array of pairs of cards
     * @return {Array} Shuffled array of pairs of cards
     */
    static generateCards() {
        const result = []
        const size = SIDE * SIDE
        const candidates = Array.from(SYMBOLS) // convert string to array of chars
        // Keep this loop to control number of
        // cards with variable SIDE
        while (result.length &lt; size) {
            const card = candidates.pop()
            result.push(card, card)
        }
        return shuffle(result)
    }

    constructor(props) {
        super(props)
        this.state = {
            cards: App.generateCards(),
            currentPair: [],
            guesses: 0,
            hallOfFame: null,
            matchedCardIndices: [],
        }
        /**
         * Initialize card feedbacks as hidden at the
         * start of the game
         */
        this.feedbacks = Array(SIDE * SIDE).fill('hidden')
    }

    /**
     * &lt;p>Handle event when card is clicked on&lt;/p>
     * @param {number} index Index of the card that was clicked on
     */
    // Arrow function for binding
    handleCardClick = (index) => {
        const { currentPair } = this.state

        // Prevent user from clicking when
        // the current pair already contains
        // 2 cards
        if (currentPair.length === 2) {
            return
        }

        if (currentPair.length === 0) {
            this.setState({ currentPair: [index] })
            return
        }
        this.handleNewPair(index)
    }

    /**
     * &lt;p>Flip a card when the card is selected (with tab) and enter key is pressed&lt;/p>
     * &lt;p>The card can only be selected once (i.e. only if its current feedback is `hidden`)&lt;/p>
     * @arg {Event} event onKeyPress event
     * @arg {Event} onClick onClick event
     * @arg {number} index Index of card that was clicked on
     * @arg {string} feedback Feeback of the card
     * (See possible feedback values in {@link Card}.propTypes)
     */
    // Arrow function for binding
    handleKeyPress = (e, onClick, index, feedback) => {
        if (e.key === 'Enter' &amp;&amp; feedback === 'hidden') {
            onClick(index)
        }
    }

    /**
     * Checking if both cards in the pair match
     * @param {number} index Index of the card that was clicked on
     */
    handleNewPair(index) {
        const {
            cards, currentPair, guesses, matchedCardIndices,
        } = this.state

        const newPair = [currentPair[0], index]
        const newGuesses = guesses + 1
        const matched = cards[newPair[0]] === cards[newPair[1]]
        this.setState({ currentPair: newPair, guesses: newGuesses })
        if (matched) {
            this.setState({ matchedCardIndices: [...matchedCardIndices, ...newPair] })
        }
        setTimeout(() => this.setState({ currentPair: [] }), VISUAL_PAUSE_MSECS)
    }

    /**
     * &lt;p>Get the feeback of a card&lt;/p>
     * &lt;p>See possible feedback values in {@link Card#propTypes}&lt;/p>
     * The variable `currentPair` should at maximum contain two elements (i.e. a pair)
     * @return {string} Feeback value
     */
    getFeedbackForCard(index) {
        const { currentPair, matchedCardIndices } = this.state
        const indexMatched = matchedCardIndices.includes(index)
        const currentFeedback = this.feedbacks[index]
        let newFeedback = ''

        if (currentFeedback === 'justMatched' || currentFeedback === 'disabled') {
            newFeedback = 'disabled'
        } else if (currentPair.length &lt; 2) {
            newFeedback = currentPair.includes(index) ? 'visible' : 'hidden'
        } else if (currentPair.includes(index)) {
            // implicit (currentPair.length === 2) as a pair is at most composed of two elements
            newFeedback = indexMatched ? 'justMatched' : 'justMismatched'
        } else {
            // implicit (currentPair.length === 2) as a pair is at most composed of two elements
            newFeedback = indexMatched ? 'visible' : 'hidden'
        }
        this.feedbacks[index] = newFeedback
        return newFeedback
    }

    /**
     * &lt;p>Display information about the winners&lt;/p>
     * @param {HallOfFame} hallOfFame Information about the winners
     */
    // Arrow function for binding
    // (i.e. to access `this` of the current object,
    // instead of doing
    // this.displayHallOfFame = this.displayHallOfFame.bind(this)
    // in the constructor)
    displayHallOfFame = (hallOfFame) => {
        this.setState({ hallOfFame })
        // where { hallOfFame } is shorthand for { hallOfFame: hallOfFame }
    }

    /**
     * Render the whole game
     */
    render() {
        const {
            cards, guesses, hallOfFame, matchedCardIndices,
        } = this.state
        // Game is won when there are as many matched cards as there are cards
        // in the game
        const won = matchedCardIndices.length === cards.length
        return (
            &lt;div className="memory">
                {/* &lt;span>{`Seconds ${new Date().getSeconds()}`}&lt;/span> */}
                &lt;GuessCount guesses={guesses} />
                { cards.map((card, index) => (
                    &lt;Card
                        card={card}
                        feedback={this.getFeedbackForCard(index)}
                        key={index} // key must be unique and stable in time
                        index={index}
                        onClick={this.handleCardClick}
                        onKeyPress={this.handleKeyPress}
                    />
                ))}
                {won &amp;&amp; (hallOfFame ? (&lt;HallOfFame entries={hallOfFame} />
                ) : (
                    &lt;HighScoreInput
                        guesses={guesses}
                        onStored={this.displayHallOfFame}
                    />
                ))}
            &lt;/div>
        )
    }
}

export default App
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="App.html">App</a></li><li><a href="Card.html">Card</a></li><li><a href="GuessCount.html">GuessCount</a></li><li><a href="HallOfFame.html">HallOfFame</a></li><li><a href="HighScoreInput.html">HighScoreInput</a></li></ul><h3>Global</h3><ul><li><a href="global.html#emptyHOF">emptyHOF</a></li><li><a href="global.html#saveHOFEntry">saveHOFEntry</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Tue Dec 22 2020 12:49:45 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
